# =============================================================================
# Route53 DNS 설정 - LiveKit 서버
# =============================================================================
# LiveKit 서버의 Public IP를 서브도메인에 자동 연결
# =============================================================================

# -----------------------------------------------------------------------------
# 기존 Route53 호스팅 영역 참조
# -----------------------------------------------------------------------------
data "aws_route53_zone" "main" {
  name = "sodam.store"
}

# -----------------------------------------------------------------------------
# A 레코드 생성 (LiveKit 서버 IP 연결)
# -----------------------------------------------------------------------------
resource "aws_route53_record" "livekit_dev" {
  zone_id = data.aws_route53_zone.main.zone_id
  name    = "livekit.sodam.store" # LiveKit 개발 서버 서브도메인
  type    = "A"
  ttl     = 60 # 1분 (개발 환경, IP 변경 시 빠른 전파)

  # EC2 인스턴스의 자동 할당 Public IP 사용
  records = [module.livekit_server.public_ips[0]]
}

# -----------------------------------------------------------------------------
# Outputs
# -----------------------------------------------------------------------------
output "livekit_domain" {
  description = "LiveKit 서버 도메인 (개발자가 사용할 URL)"
  value       = aws_route53_record.livekit_dev.fqdn
}
