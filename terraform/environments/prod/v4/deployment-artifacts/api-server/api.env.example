# =============================================================================
# Production v3 API Server Environment Variables
# =============================================================================

# Timezone
TZ=Asia/Seoul

# Internal API Authentication (MUST match ops-agent API_INTERNAL_TOKEN)
API_INTERNAL_TOKEN=<YOUR_SECRET_INTERNAL_TOKEN>

# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Production 필수 변경 값들
# LiveKit Server Connection
LIVEKIT_URL=https://livekit.sodam.store
REDIS_URL=redis://<RDS_ELASTICACHE_ENDPOINT>:6379
DATABASE_URL=postgresql://<RDS_USERNAME>:<RDS_PASSWORD>@<RDS_ENDPOINT>:5432/<DB_NAME>
AGENT_NAME=voice-agent

# Production 보안 설정
API_AUTH_REQUIRED=true
CORS_ORIGIN=https://sodam.store,https://www.sodam.store
# <<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Production 필수 변경 값들

# Server Configuration
PORT=8080

# LiveKit Configuration
LIVEKIT_API_KEY=<YOUR_LIVEKIT_API_KEY>
LIVEKIT_API_SECRET=<YOUR_LIVEKIT_API_SECRET>
LIVEKIT_TOKEN_TTL=600

# JWT Configuration
API_JWT_SECRET=<YOUR_SECURE_JWT_SECRET>
API_JWT_TTL=86400

# APNS (Apple Push Notification Service)
APNS_KEY_PATH=/secrets/AuthKey_X6V2QBWP93.p8
APNS_KEY_ID=X6V2QBWP93
APNS_TEAM_ID=4Y5BW58548
APNS_BUNDLE_ID=com.ilim.damso
APNS_VOIP_TOPIC=com.ilim.damso.voip
APNS_ENV=production

# OAuth - Kakao
KAKAO_ADMIN_KEY=<YOUR_KAKAO_ADMIN_KEY>
KAKAO_CLIENT_ID=<YOUR_KAKAO_CLIENT_ID>
KAKAO_CLIENT_SECRET=<YOUR_KAKAO_CLIENT_SECRET>

# OAuth - Google
GOOGLE_CLIENT_ID=<YOUR_GOOGLE_CLIENT_ID>
GOOGLE_CLIENT_SECRET=<YOUR_GOOGLE_CLIENT_SECRET>

# AI Service (Bedrock)
AI_PROVIDER=bedrock
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=<YOUR_AWS_ACCESS_KEY>
AWS_SECRET_ACCESS_KEY=<YOUR_AWS_SECRET_KEY>
BEDROCK_MODEL=global.anthropic.claude-sonnet-4-5-20250929-v1:0
AI_MAX_TOKENS=2000
AI_INSTRUCTION='당신은 따뜻한 마음을 가진 노인 심리 상담가입니다. 대화의 이면을 깊이 있게 분석해주세요.'

# RAG (Vector Search) Configuration
# Uses AWS Bedrock Titan Embeddings V2 (same AWS credentials as above)

# Embedding Model Configuration
EMBEDDING_MODEL=amazon.titan-embed-text-v2:0
VECTOR_DIMENSIONS=1024                  # Titan Embeddings V2 uses 1024 dimensions (fixed)

# RAG Search Configuration
RAG_SEARCH_LIMIT=5                      # Number of similar conversation chunks to return per search
RAG_CHUNK_SIZE=500                      # Character length of each parent chunk (larger for context)
RAG_CHUNK_OVERLAP=50                    # Character overlap between parent chunks

# Parent-Child RAG Configuration
RAG_CHILD_CHUNK_SIZE=200                # Child chunk size for searchable units (smaller for precision)
RAG_CHILD_CHUNK_OVERLAP=50              # Child chunk overlap for context continuity
RAG_WINDOW_CONTEXT_CHARS=150            # Window size for snippet extraction (chars before/after child match)
RAG_CHILD_SEARCH_MULTIPLIER=3           # PGVector child search expansion factor
RAG_DEBUG_LOGS=false                    # Enable detailed RAG debug logs (true/false)

# RAG Similarity Filtering
SIMILARITY_THRESHOLD=0.0                # Minimum cosine similarity (0.0-1.0) to return search results (0.0 = no filtering)

# Bedrock Retry Configuration
BEDROCK_MAX_RETRIES=3                   # Maximum number of retry attempts for Bedrock API calls
BEDROCK_RETRY_DELAY_MS=1000             # Initial retry delay in milliseconds
BEDROCK_RETRY_BACKOFF_FACTOR=2          # Exponential backoff multiplier (delay doubles each retry)

# Redis Cache Configuration
REDIS_CACHE_TTL=3600                    # Redis vector cache TTL in seconds (1 hour)
REDIS_GREETING_TTL=600                  # Redis greeting cache TTL in seconds (10 minutes)
WEEKLY_CONTEXT_DAYS=7                   # Number of days of conversation history to cache in Redis

# Bull Board UI Authentication (RAG Indexing Queue Monitoring)
# Accessible at /admin/queues
ADMIN_USER=<YOUR_ADMIN_USER>            # Bull Board UI username (required)
ADMIN_PASS=<YOUR_SECURE_PASSWORD>       # Bull Board UI password (required)

# Worker Configuration
WORKER_CONCURRENCY=5                    # Number of concurrent indexing jobs (consider AWS Bedrock quota)
RAG_INDEXING_DELAY_MS=1000              # Delay before enqueueing indexing jobs (ms, 0 to disable)

# Production Memory Settings
REDIS_MAXMEMORY=1gb                     # Redis maxmemory (managed by ElastiCache)
WORKER_MEMORY_LIMIT=2G                  # Worker container memory limit
