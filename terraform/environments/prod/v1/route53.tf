# =============================================================================
# Route53 DNS 설정
# =============================================================================
# 배포 서버의 Public IP를 도메인에 자동 연결
# =============================================================================

# -----------------------------------------------------------------------------
# 기존 Route53 호스팅 영역 참조
# -----------------------------------------------------------------------------
# 사전 준비: Route53에서 도메인 호스팅 영역이 생성되어 있어야 함
# 예: AWS Console → Route53 → Hosted zones → Create hosted zone
data "aws_route53_zone" "main" {
  name = "sodam.store"

  # private_zone = false  # Public 호스팅 영역
}

# -----------------------------------------------------------------------------
# A 레코드 생성 (배포 서버 IP 연결)
# -----------------------------------------------------------------------------
resource "aws_route53_record" "prod_v1" {
  zone_id = data.aws_route53_zone.main.zone_id
  name    = "sodam.store"
  type    = "A"
  ttl     = 60 # 1분; 어차피 테스트 정도로 사용될 예정

  # 동적으로 생성된 EC2의 Public IP
  records = [module.prod_server.public_ips[0]]
}

# -----------------------------------------------------------------------------
# Outputs
# -----------------------------------------------------------------------------
output "domain_name" {
  description = "배포 서버 도메인 주소"
  value       = aws_route53_record.prod_v1.fqdn
}
