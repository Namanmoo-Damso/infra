services:
    # [Target] FE 개발 (소스 마운트)
    # 프론트엔드 개발 환경을 위한 컨테이너입니다. 로컬 소스코드를 마운트하여 실시간 반영됩니다.
    fe-client:
        image: node:20-alpine
        working_dir: /app
        volumes:
            - .:/app # FE repository의 root 위치에 docker-compose.yml을 위치
            - /app/node_modules # node-modules 내부의 라이브러리들을 컨테이너 환경에 맞게 격리하기 위해 anonymous-volume 사용. 새로운 라이브러리를 설치할 때 local에선 생략하고 container에 접속해서 설치
        ports:
            - "3000:3000" # FE 개발 서버 포트 (브라우저 접속용)
        command: npm run dev
        env_file: .env.dev
        depends_on:
            - be-server
            - ai-server

    # [Background] BE 서버 (레지스트리 이미지)
    # 백엔드 API 서버입니다. 레지스트리에서 이미지를 가져와 실행합니다.
    be-server:
        image: my-registry.com/be-server:latest
        ports:
            - "8080:8080" # 백엔드 API 서버 포트
        environment:
            - POSTGRES_HOST=postgres # PostgreSQL 데이터베이스 호스트
            - REDIS_HOST=redis # Redis 캐시 서버 호스트
            - MONGO_HOST=mongodb # MongoDB 호스트
            - LIVEKIT_URL=ws://livekit:7880 # LiveKit 서버 WebSocket URL
        depends_on:
            - postgres
            - redis
            - mongodb
            - livekit

    # [Background] AI 서버 (레지스트리 이미지 - CPU 모드 권장)
    # AI 모델 서빙 및 RAG 파이프라인 서버입니다.
    # ai-server:
    #     image: my-registry.com/ai-server:latest
    #     ports:
    #         - "8000:8000" # AI 서버 API 포트
    #     environment:
    #         - WEAVIATE_URL=http://weaviate:8080 # Weaviate 벡터 DB URL
    #         - DB_HOST=postgres # 메타데이터 저장용 RDB 호스트
    #     depends_on:
    #         - weaviate
    #         - postgres

    # --- Infrastructure ---
    # 관계형 데이터베이스 (RDBMS) 서비스입니다.
    postgres:
        image: postgres:15-alpine
        environment:
            POSTGRES_USER: user # DB 접속 계정
            POSTGRES_PASSWORD: password # DB 접속 비밀번호
            POSTGRES_DB: mydb # 초기 생성할 데이터베이스 이름
        ports:
            - "5432:5432" # PostgreSQL 접속 포트

    # 실시간 영상/음성 통신을 위한 WebRTC 서버입니다.
    livekit:
        image: livekit/livekit-server:latest
        command: --dev
        ports:
            - "7880:7880" # LiveKit API 및 WebSocket 포트
            - "7881:7881" # LiveKit TCP 포트 (TURN 등)
            - "7882:7882/udp" # LiveKit UDP 포트 (RTP 미디어 전송)

    # NoSQL 데이터베이스 (Document DB) 서비스입니다. 비정형 데이터 저장에 사용됩니다.
    mongodb:
        image: mongo:latest
        ports:
            - "27017:27017" # MongoDB 접속 포트
        environment:
            MONGO_INITDB_ROOT_USERNAME: root # MongoDB 루트 계정
            MONGO_INITDB_ROOT_PASSWORD: password # MongoDB 루트 비밀번호

    # 인메모리 데이터 구조 저장소 (캐시/메시지 브로커) 서비스입니다.
    redis:
        image: redis:alpine
        ports:
            - "6379:6379" # Redis 접속 포트

    # 오픈소스 벡터 데이터베이스입니다. RAG 파이프라인에서 임베딩 검색에 사용됩니다.
    # weaviate:
    #     image: semitechnologies/weaviate:latest
    #     ports:
    #         - "8081:8080" # Weaviate HTTP API 포트 (호스트 8081 -> 컨테이너 8080)
    #         - "50051:50051" # Weaviate gRPC 포트
    #     environment:
    #         QUERY_DEFAULTS_LIMIT: 25 # 검색 결과 기본 제한 수
    #         AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: 'true' # 익명 접속 허용 여부
    #         DEFAULT_VECTORIZER_MODULE: 'none' # 기본 벡터화 모듈 (외부 모델 사용 시 none)
